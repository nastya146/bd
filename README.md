# База данных для онлайн сервиса по покупке, продаже и сдаче в аренду недвижимости
1. **Концептуальная модель**
  ![Image 1](concept_model.jpg)
2. **Логическая + физическая модель**
  ![Image 2](logic_model.png)
Для нормализации таблицы “избранное пользователя”, чтобы значения были скалярными, введена таблица покупатель-избранное, где фиксируется отдельно каждая пара пользователь - квартира, которую он добавил в избранное. Во всех остальных таблицах значения скалярные и строки в них уникальные, поэтому схема приведена в 1NF.
Так как все неключевые атрибуты зависят от первичного ключа, то база данных находится и в 2NF.
Для хранения изменений данных в таблице квартир используем 4 тип версионироваиня. Добавили отдельную таблицу “история”, в которой каждое изменение стоимости или статуса каждой квартиры будет фиксироваться и иметь свой идентификатор.

3. **Таблицы с описанием и ограничением для каждого атрибута**

|квартиры  ||||
| ---------|---------|---------|---------|
| **название**  | **описание** | **тип данных** | **ограничения** |
|apartament_id|идентификатор квартиры|int|primary key|
|house_id|индентификатор дома, в котором находится квартира|int|not null|
|rooms|количество комнат|int|not null, 1 <= rooms <= 30|
|area|площадь квартиры|float|not null, 0 < area <= 6500|
|owner_id|идентификатор пользователя - текущего владельца квартиры|int|not null|
|cost|стоимость квартиры|float|not null, 0 < cost|
|change_date|дата последнего изменения объявления|date|not null, defaulte(current_date)|
|status|состояние квартиры (продажа: жилая или коммерческая; аренда: жилая, коммерческая, посуточно; продана, арендуется)|varchar(20)|not null|


|пользователь  ||||
| ---------|---------|---------|---------|
| **название**  | **описание** | **тип данных** | **ограничения** |
|user_id|идентификатор пользователя|int|primary key|
|full_name|фио пользователя|varchar(200)|not null|
|registration_date|дата регистрации пользователя|date|default (current_date)|
|birthday|дата рождения пользователя|date|birthday < registration_date, datediff(year, birthday, registration_date) >= 18|
|telephone|номер телефона пользователя|int|unique, not null|
|address|почта пользователя|varchar(200)|unique|

|операции с квартирами ||||
| ---------|---------|---------|---------|
| **название**  | **описание** | **тип данных** | **ограничения** |
|transaction_id|идентификатор транзакции|int|primary key|
|appartament_id|идентификатор квартиры, с которой  производится операция|int|not null|
|user_id|идентификатор пользователя: покупателя|int|not null|
|data_transition|дата перевода|date|default(current_date)|
|cost|сумма перевода|float|0 < cost|

|покупатель-избранное ||||
| ---------|---------|---------|---------|
| **название**  | **описание** | **тип данных** | **ограничения** |
|pair_id|идентификатор транзакции|int|primary key|
|apartment_id|идентификатор квартиры, которая понравилась пользователю|int|not null|
|user_id|идентификатор пользователя: потенциального покупателя|int|not null|

|отзывы ||||
| ---------|---------|---------|---------|
| **название**  | **описание** | **тип данных** | **ограничения** |
|comment_id|идентификатор транзакции|int|primary key|
|apartment_id|идентификатор квартиры|int|not null|
|user_id|идентификатор пользователя: покупателя|int|not null|
|дата_отзыва|дата публикации отзыва|date|not null|
|rating|оценка квариры|int|not null, 0 <= rating <= 5|
|comment|коментарий пользователя(плюсы и минусы квартиры)|memo||

|дома ||||
| ---------|---------|---------|---------|
| **название**  | **описание** | **тип данных** | **ограничения** |
|house_id|идентификатор дома|int|primary key|
|address|адресс дома|varchar(200)|not null|
|district|район|varchar(100)||
|num_floors|этажность дома|int|0 < num_floors < 200|
|class|класс жилья (стандарт, комфорт, бизнес, элит)|varchar(20)||
|rating|средняя оценка квартир дома|decimal|0 <= rating <= 5|


|история ||||
| ---------|---------|---------|---------|
| **название**  | **описание** | **тип данных** | **ограничения** |
|history_id|идентификатор квартиры с неактуальными данными|int|primary key|
|apartament_id|идентификатор квартиры|int|not  null|
|owner_id|идентификатор текущего владельца квартиры|int|not null|
|cost|стоимость квартиры|float|0 < cost|
|change_date|дата изменения (добавления) объявления|date|not null|
|status|состояние квартиры (продается, продана, арендуется)|varchar(20)|not null|

4. Скрипты создания схемы, ее заполнения данными и 10 осмысленных запросов , со смысловым описанием желаемого вывода, смотреть в файлах ... .







